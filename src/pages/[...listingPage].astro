---
import fetchListings from '../pages/api/gapi'; // Adjust the import path as needed
import ListingPageDetail from '../components/ListingPageDetail.astro';

interface ListingProps {
  title: string;
  propertyType: string;
  bathrooms: number;
  pictures: string[];
  beds: number;
  description: string;
}

type GetReturnType = 
  | { props: ListingProps }
  | { status: number; body: string };

export async function get({ params }): Promise<GetReturnType> {
  const listings = await fetchListings(); // Fetch listings again to find the specific one
  const listing = listings.find((listing) => listing._id === params.listingPage);

  if (!listing) {
    return {
      status: 404,
      body: 'Listing not found'
    };
  }

  console.log("Fetched listing in get function:", listing); // Log fetched listing

  return {
    props: {
      title: listing.title,
      propertyType: listing.propertyType,
      bathrooms: listing.bathrooms,
      pictures: listing.pictures,
      beds: listing.beds,
      description: listing.publicDescription
    }
  };
}
---

<ListingPageDetail {...Astro.props} />