---
const API_URL = import.meta.env.PUBLIC_NOETICS_CMS_API_URL + "/posts";
let posts = [];

try {
    const res = await fetch(API_URL);
    if (!res.ok) throw new Error(`Failed to fetch posts: ${res.statusText}`);
    posts = await res.json();
} catch (error) {
    console.error("Error fetching blog posts:", error);
}
---

<h1>Blog</h1>

{
    posts?.length > 0 ? (
        posts.map((post) => (
            <article>
                <h2>
                    <a href={`/blog/${post.slug}`}>{post.title}</a>
                </h2>
                {post.featured_image && (
                    <img src={post.featured_image} alt={post.title} />
                )}
                <p>{post.excerpt || "No excerpt available."}</p>
                <p>
                    <strong>Published:</strong>{" "}
                    {post.published_at || "Unpublished"}
                </p>
            </article>
        ))
    ) : (
        <p>No posts available.</p>
    )
}
