---
import {fetchFeaturedListings} from '../pages/api/fetch';
const fetchListings = await fetchFeaturedListings();
async function fetchFromNetlifyFunction(endpoint: string): Promise<any> {
  const response = await fetch(`/.netlify/functions/${endpoint}`);
  if (!response.ok) {
    throw new Error(`Failed to fetch from ${endpoint}: ${response.status} ${response.statusText}`);
  }
  return await response.json();
}

let listingsFeatured = [];
try {
  listingsFeatured = await fetchFromNetlifyFunction('fetchListings?type=featured');
} catch (error) {
  console.error('Error fetching listings:', error);
}
const listings = listingsFeatured;

---

  {
      fetchListings.map(({bedrooms, picture, pictures, title, address, bathrooms, prices, _id, results}) => (
  <a href={_id}>
      <article class="flex flex-col bg-white shadow-lg shadow-muted-300/30 h-full border border-muted-200">
              <div class="bg-muted-100">
              <img class="w-full h-48 object-cover" id="string" src={pictures[0].original} height="300px" width="300px"/>
            </div>
            <div class="p-5 bg-white flex flex-col justify-start h-2/6">
          <div class="">
            <h4 class="font-sans font-bold text-xl text-muted-900">
              {title} 
            </h4>
            <h3 class="font-sans font-bold text-xl text-muted-900">
              ${prices.basePrice}/ Day
            </h3>
            <p class="text-sm text-muted-400">
              
              {address.city}, {address.state}
            </p>
          </div>
          <hr class="border-t border-muted-200 dark:border-muted-800 my-5" />
          <div class="h-max grid grid-cols-2 flex-row justify-center items-center">
            <!-- bedroom -->
            <div class="flex flex-col items-center">
              <div class="flex items-center gap-2 text-muted-900 dark:text-white">
                <svg
                  class="size-8"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  style="--darkreader-inline-stroke: currentColor;"
                  data-darkreader-inline-stroke=""
                  ><path d="M2 20v-8a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v8"></path><path d="M4 10V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v4"></path><path d="M12 4v6"></path><path d="M2 18h20"></path>
                </svg>
    
                <p class="text-xl font-bold">{bedrooms}</p>
              </div>
    
              <p class="text-md text-muted-400">Bedrooms</p>
            </div>
            <!-- bathroom -->
            <div class="flex flex-col items-center">
              <div class="flex items-center gap-2 text-muted-900 dark:text-white">
                <svg
                  class="size-8"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  style="--darkreader-inline-stroke: currentColor;"
                  data-darkreader-inline-stroke=""
                  ><path d="M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5"></path><line x1="10" y1="5" x2="8" y2="7"></line><line
                    x1="2"
                    y1="12"
                    x2="22"
                    y2="12"></line><line x1="7" y1="19" x2="7" y2="21"></line><line x1="17" y1="19" x2="17" y2="21"></line>
                </svg>
    
                <p class="text-xl font-bold">{bathrooms}</p>
              </div>
    
              <p class="text-md text-muted-400">Bathroom</p>
            </div>
  
          </div>
        </div>
      </article>
    </a>
    )
    )
    } 
